{% extends "base.html" %}
{% block title %}SasksVoice â€” Track Your Submissions{% endblock %}

{% block content %}
<section class="page-section">
    <div class="page-container">
        <h1 class="page-title">Track Your <span class="gradient-text">Posts</span></h1>
        <p class="form-subtitle" style="margin-bottom: 32px; color: var(--text-secondary);">
            Enter your email to see the status of all your submissions. No account needed!
        </p>

        <!-- Email Lookup Form -->
        <form action="{{ url_for('main.track_submission') }}" method="GET" class="form-container"
            style="margin-bottom: 40px;">
            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 250px;">
                    <input type="email" name="email" class="form-input" placeholder="Enter your email address"
                        value="{{ email }}" required>
                </div>
                <button type="submit" class="submit-btn" style="width: auto; padding: 14px 32px; margin-top: 0;">
                    <i class="bi bi-search"></i> Look Up
                </button>
            </div>
        </form>

        {% if email %}
        <!-- Results -->
        {% if submissions %}
        <div style="margin-bottom: 16px;">
            <p style="color: var(--text-secondary); font-size: 0.95rem;">
                Found <strong style="color: var(--accent);">{{ submissions|length }}</strong> submission(s) for
                <strong style="color: var(--text-primary);">{{ email }}</strong>
            </p>
        </div>

        <div style="display: flex; flex-direction: column; gap: 16px;">
            {% for sub in submissions %}
            <div class="form-container" style="padding: 24px;">
                <div style="display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap;">
                    <!-- Thumbnail -->
                    <div style="flex-shrink: 0;">
                        <img src="{{ url_for('static', filename='../' + 'uploads/' + sub.image_path) }}"
                            alt="Submission"
                            style="width: 100px; height: 100px; border-radius: 12px; object-fit: cover; border: 1px solid var(--border-color);"
                            onerror="this.style.display='none'">
                    </div>

                    <!-- Info -->
                    <div style="flex: 1; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <span style="font-weight: 700; font-size: 1.1rem;">#{{ sub.id }}</span>

                            <!-- Status Badge -->
                            {% set status_colors = {
                            'pending': '#ffb545',
                            'approved': '#2dd4a8',
                            'published': '#9478ff',
                            'rejected': '#ff5c6c',
                            'flagged': '#ff6b6b',
                            'payment_pending': '#ffb545'
                            } %}
                            <span style="
                                padding: 4px 12px;
                                border-radius: 20px;
                                font-size: 0.75rem;
                                font-weight: 600;
                                text-transform: uppercase;
                                background: {{ status_colors.get(sub.status, '#888') }}20;
                                color: {{ status_colors.get(sub.status, '#888') }};
                                border: 1px solid {{ status_colors.get(sub.status, '#888') }}40;
                            ">
                                {% if sub.status == 'payment_pending' %}â³ Awaiting Payment
                                {% elif sub.status == 'pending' %}ğŸ” Under Review
                                {% elif sub.status == 'approved' %}âœ… Approved
                                {% elif sub.status == 'published' %}ğŸ“¸ Published
                                {% elif sub.status == 'rejected' %}âŒ Rejected
                                {% elif sub.status == 'flagged' %}âš ï¸ Flagged
                                {% else %}{{ sub.status }}{% endif %}
                            </span>

                            <!-- Post Type -->
                            <span style="
                                padding: 4px 10px;
                                border-radius: 20px;
                                font-size: 0.7rem;
                                font-weight: 600;
                                background: {% if sub.post_type == 'promotional' %}rgba(124,92,255,0.12){% else %}rgba(255,255,255,0.06){% endif %};
                                color: {% if sub.post_type == 'promotional' %}#9478ff{% else %}var(--text-muted){% endif %};
                            ">
                                {% if sub.post_type == 'promotional' %}ğŸ’ Promotional{% else %}ğŸ†“ Free{% endif %}
                            </span>
                        </div>

                        <!-- Caption Preview -->
                        <p
                            style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; margin-bottom: 8px;">
                            {{ sub.caption[:150] }}{% if sub.caption|length > 150 %}...{% endif %}
                        </p>

                        <!-- Date -->
                        <p style="color: var(--text-muted); font-size: 0.8rem;">
                            <i class="bi bi-clock"></i> Submitted: {{ sub.created_at.strftime('%b %d, %Y at %I:%M %p')
                            }}
                        </p>

                        <!-- Status Info -->
                        {% if sub.status == 'published' and sub.instagram_post_id %}
                        <p style="color: #2dd4a8; font-size: 0.85rem; margin-top: 6px;">
                            <i class="bi bi-instagram"></i> Published on Instagram
                        </p>
                        {% elif sub.status == 'payment_pending' %}
                        <p style="color: #ffb545; font-size: 0.85rem; margin-top: 6px;">
                            <i class="bi bi-credit-card"></i> Complete payment to proceed with review
                        </p>
                        {% elif sub.status == 'pending' %}
                        <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 6px;">
                            <i class="bi bi-hourglass-split"></i> Your post is in the review queue
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <div class="form-container" style="text-align: center; padding: 48px 24px;">
            <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“­</div>
            <h3 style="margin-bottom: 8px;">No Submissions Found</h3>
            <p style="color: var(--text-secondary);">No posts found for <strong>{{ email }}</strong>. Try a different
                email or submit your first post!</p>
            <a href="{{ url_for('main.index') }}" class="success-cta" style="margin-top: 24px;">
                <i class="bi bi-plus-circle"></i> Submit a Post
            </a>
        </div>
        {% endif %}
        {% endif %}
    </div>
</section>
{% endblock %}